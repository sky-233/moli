@{
    ViewBag.Title = "百科聊天Beta v 1.0";
    Layout = "~/Views/Shared/_BlankLayout.cshtml";
}
<style>
    body {
        padding-top: 0;
        overflow: hidden;
        background-image:none;
    }
</style>

<div class="container pl10 npr">
    <section class="chat">
        <ul class="nav nav-tabs nav-tabs-justified chat-tab" role="tablist">
            <li role="presentation" class="active">
                <a href="#chatPublic" aria-controls="chatPublic" role="tab" data-toggle="tab">
                    公共聊天 <div class="new-notice">99+</div>
                </a>
            </li>
            <li role="presentation">
                <a href="#chatFriends" aria-controls="chatFriends" role="tab" data-toggle="tab">
                    我的好友
                    <div class="new-notice">3</div>
                </a>
            </li>
            <li role="presentation"><a href="#chatPrivate" aria-controls="chatPrivate" role="tab" data-toggle="tab">私聊</a></li>
            <li role="presentation"><a href="#chatHistory" aria-controls="chatHistory" role="tab" data-toggle="tab">聊天记录</a></li>
        </ul>

        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active  chat-tab-content" id="chatPublic">
                <div class="chat-content">
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <a href="#" title="" target="_blank" class="fb">用户2</a> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [01]我总觉得楼上很帅
                        </div>
                    </div>
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <a href="#" title="" target="_blank" class="fb">用户3</a> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [11][32]合影
                        </div>
                    </div>
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>用户1</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [11]我总觉得你在笑我傻比
                        </div>
                    </div>
                    <div class="chating-item my-message">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>我</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [01]没有，他绝对没有
                        </div>
                    </div>
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>用户名</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [30]
                        </div>
                    </div>
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>用户名</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            组队！半山任务1Q4++++++[04]
                        </div>
                    </div>
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>用户名</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [01][02]曲尼码毕[03]
                        </div>
                    </div>
                    <div class="chating-item my-message">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>我</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            你们……[28]我屮艸芔茻！！！！你们这是在作死啊，草你麻痹！！！够两行字没有?
                        </div>
                    </div>
                </div>
                <div class="chat-control">
                    <div id="errorPublic" class="dn tip-error long-error">你写太多了！(ノಠ益ಠ)ノ彡┻━┻</div>
                    <div class="btn-group chat-expand" role="group">
                        <div class="btn-group btn-group-xs" role="group">
                            <button type="button" class="btn btn-default bg-gray "><span class="fa fa-smile-o"></span> 表情</button>
                        </div>
                        <div class="btn-group btn-group-xs" role="group">
                            <button type="button" class="btn btn-danger"><span class="fa fa-eraser "></span> 清屏</button>
                        </div>
                    </div>
                    <div class="list-table list-table-middle">
                        <div>
                            <textarea rows="2" placeholder="消耗2贡献值，基佬，来一发撒~" id="txtBoxPublic" class="chat-txtbox"></textarea>
                        </div>
                        <div class="chat-btn">
                            <button type="button" id="btnSubmitPublic" class="btn bg-primary chat-btn-submit">发送</button>
                        </div>
                    </div>
                    <div class="chat-info list-table list-table-middle">
                        <div class="fc-gray">
                            <span id="valCountPublic">0</span> / 200
                        </div>
                        <div class="text-right">
                            您的贡献：<span class="fc-red">88</span> / 可发送：<span class="fc-red">44</span> 次
                        </div>
                    </div>
                </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="chatFriends">
                <div class="media">
                    <div class="media-left media-middle">
                        <a href="#">
                            <img class="media-object" src="~/Content/images/test/avatar.jpg" />
                        </a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">用户名</h4>
                        <div>
                            <a href="#" class="btn btn-default" title="详情">详情</a>
                            <a href="#" class="btn btn-default" title="私聊">私聊</a>
                            <a href="#" class="btn btn-default" title="历史">历史</a>
                            <a href="#" class="btn btn-default" title="删除">删除</a>
                        </div>
                    </div>
                </div>
            </div>
            <div role="tabpanel" class="tab-pane  chat-tab-content" id="chatPrivate">
                <div class="chat-content">
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>ACE</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [01]我总觉得楼上很帅
                        </div>
                    </div>
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>ACE</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [11][32]合影
                        </div>
                    </div>
                    <div class="chating-item">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>ACE</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [11]我总觉得你在笑我傻比
                        </div>
                    </div>
                    <div class="chating-item my-message">
                        <div class="title">
                            <small class=" rounded title-badge">头衔</small>
                            <b>我</b> <small class="fc-gray">2016-10-24 10:53:32</small>
                        </div>
                        <div class="content" data-id="chatingContent">
                            [01]没有，他绝对没有
                        </div>
                    </div>
                </div>
                <div class="chat-control">
                    <div id="errorPriv" class="dn tip-error long-error">你写太多了！(ノಠ益ಠ)ノ彡┻━┻</div>
                    <div class="btn-group chat-expand" role="group">
                        <div class="btn-group btn-group-xs" role="group">
                            <button type="button" class="btn btn-default bg-gray "><span class="fa fa-smile-o"></span> 表情</button>
                        </div>
                        <div class="btn-group btn-group-xs" role="group">
                            <button type="button" class="btn btn-danger"><span class="fa fa-eraser "></span> 清屏</button>
                        </div>
                    </div>
                    <div class="list-table list-table-middle">
                        <div>
                            <textarea rows="2" placeholder="消耗2贡献值，基佬，来一发撒~" id="txtBoxPriv" class="chat-txtbox"></textarea>
                        </div>
                        <div class="chat-btn">
                            <button type="button" id="btnSubmitPriv" class="btn bg-primary chat-btn-submit">发送</button>
                        </div>
                    </div>
                    <div class="chat-info list-table list-table-middle">
                        <div class="fc-gray">
                            <span id="valCountPriv">0</span> / 200
                        </div>
                        <div class="text-right">
                            正在和<b class="fc-red">ACE</b> 私聊
                        </div>
                    </div>
                </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="chatHistory">
            </div>
        </div>
    </section>
</div>
<div class="emoji">
    <ul class="grid-avg grid-avg-4"></ul>
</div>
<script>
    $(function () {
        chatContentHeight();
        $(window).resize(function () {
            chatContentHeight();
        })
        $('#txtBoxPublic').bind('input propertychange', function () {
            inputChange($(this), $('#valCountPublic'), $('#btnSubmitPublic'), $('#errorPublic'));
        });
        $('#txtBoxPriv').bind('input propertychange', function () {
            inputChange($(this), $('#valCountPriv'), $('#btnSubmitPriv'), $('#errorPriv'));
        });
        emoji();
    });
    function emoji() {
        var emojiMap = {
            "[01]": "01",
            "[02]": "02",
            "[03]": "03",
            "[04]": "04",
            "[05]": "05",
            "[06]": "06",
            "[07]": "07",
            "[08]": "08",
            "[09]": "09",
            "[10]": "10",
            "[11]": "11",
            "[12]": "12",
            "[13]": "13",
            "[14]": "14",
            "[15]": "15",
            "[16]": "16",
            "[17]": "17",
            "[18]": "18",
            "[19]": "19",
            "[20]": "20",
            "[21]": "21",
            "[22]": "22",
            "[23]": "23",
            "[24]": "24",
            "[25]": "25",
            "[26]": "26",
            "[27]": "27",
            "[28]": "28",
            "[29]": "29",
            "[30]": "30",
            "[31]": "31",
            "[32]": "32",
            "[33]": "33",
            "[34]": "34",
            "[35]": "35"
        };
        var str = /\[\d{2}\]/;
        var arr = [];
        var content = $('[data-id="chatingContent"]');
        var reg = new RegExp(str, 'g');
        for (var i = 0; i < content.length; i++) {
            var new_content = content.eq(i).html().replace(reg, function (r) {
                return '<img src="../Content/images/paopao/' + emojiMap[r] + '.png" />';
            });
            content.eq(i).html(new_content);
        }
    }
    function inputChange(_this, count, btnsubmit, error) {
        var this_length = _this.val().length;
        count.text(this_length);
        if (this_length > 200) {
            count.css({ 'color': 'red' });
            btnsubmit.attr('disabled', 'disabled');
            error.fadeIn(100);
        } else {
            count.css({ 'color': '#bbb' });
            btnsubmit.removeAttr('disabled');
            error.fadeOut(100);
        }
    }
    function chatContentHeight() {
        setTimeout(function () {
            var chat_content = $('.chat-tab-content'),
                chat_tab = $('.chat-tab'),
               chat_control = $('.chat-control');
            chat_content.height($(window).height() - (chat_control.height() + chat_tab.height()));
        }, 100);
    }

</script>